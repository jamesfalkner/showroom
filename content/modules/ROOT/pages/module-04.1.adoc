:imagesdir: ../assets/images


= Module 4.1: Create S/W Templates to Import Existing API/apps as a Platform Engineer

include::style.adoc[]

There are two templates created for importing existing sowftware into Developer Hub for APIs and apps/service. While it is possible to use the same template to import both of them, there are some key differences in the 
=== *Your lab environment*

.+++<u>Click to view</u>+++
[%collapsible]
====
include::env.adoc[]
====

== Explore and Import the `import-existing-api` Software Template


Since you have already learnt how to create a Software Template, we will walk through a template that has been built for you. 

Click https://gitlab-gitlab.{openshift_cluster_ingress_domain}/rhdh/import-existing-api-template/-/blob/main/template.yaml[here^] to view the `import-existing-app` Software Template

This template does the following things.

*Section 1: Gather the following details*


```yaml
  #  The `parameters` section defines the data gathered from the user
  parameters:
    # Git repo details about where this API Envelope repo lives
    - title: Provide information about Catalog Envelope to which API will be included
      properties:
        gitlabHost:
        envelopeGitlabOrganization:
        envelopeRepositoryName:

    # Details about the API that needs to be imported
    - title: Provide information about your existing API
      properties:
        gitlabOrganization:
        repositoryName:
        #Path to where API spec is defined
        apiPathText:
        #Type of API - Options are openapi/grpc etc - which helps in visualising the API
        apiType:
    
    # Additionals details about the existing API being imported as a component
    - title: Provide information about the new component for your existing API
        componentName:
        componentOwner:
        description:

```

*Section 2: Action steps*

Update the *_Envelope repo_* as a two step process

.. *Merge Request 1*: Create a new folder within  the *_Envelope repo_* and push these changes
.. *Merge Request 2*: Update the envelope file which has a list of all these _catalog_info.yaml_ files to register the newly created component, and raise a _Merge Request_

== Add the  the `import-api-catalog` Software Template to Developer Hub

* Access Red Hat Developer Hub (https://backstage-backstage.{openshift_cluster_ingress_domain}[click here^])  and login using `pe1/{common_password}`
* Click on the Create menu on the left-hand navigation. 

image::./m4/nav-create.png[]
* Click on the `Register Existing Component` button on the top-right of the page to launch the *Register an existing component* wizard 

image::./m4/nav-register-wizard.png[]
* Paste the following URL into the `Select URL` field and click on *Analyze* button
+
[source,bash,role=execute,subs="attributes"]
----
https://gitlab-gitlab.{openshift_cluster_ingress_domain}/rhdh/import-existing-api-template/-/blob/main/template.yaml
----
* Review, and Import the template by clicking on the *Import* button

image::./m4/nav-register-import.png[]

* Click on *import-api-catalog* to launch the API

image::./m4/nav-access-api-template.png[]

* Let us now register the import-app template as well


== Explore and Import the `import-existing-app` Software Template

* Repeat the same steps to import the `import-existing-app-template`
* Click *Create* (left hand nav) ->  *Register Existing Component* (top right)
* Paste the following URL 
+
[source,bash,role=execute,subs="attributes"]
----
https://gitlab-gitlab.{openshift_cluster_ingress_domain}/rhdh/import-existing-app-template/-/blob/main/template.yaml
----
* Review, and Import the template by clicking on the *Import* button

== View available templates

* Navigate back to  *Create* (left hand nav) and you should be able to see both the templates for importing APIs and Apps to Developer hub

image::./m4/import-templates-list.png[width=60%]



== Prepare Red Hat Developer Hub with the right Dynamic Plugin

The templates described above need a couple of Dynamic Plugins. 

*What are Dynamic Plugins?* +
The Red Hat Developer Hub  application offers a unified platform with various plugins. Plugins extend functionality, streamline development workflows, and improve the developer experience. You can add and configure plugins in RHDH to access various software development tools. RHDH provides both static and dynamic plugins that enhance its functionality. Static plugins are integrated into the core of the RHDH application, while dynamic plugins can be sideloaded into your Developer Hub instance without the need to recompile your code or rebuild the container.

The import templates need 2 dynamic plugins that are described below.

```yaml
- package: ./dynamic-plugins/dist/roadiehq-scaffolder-backend-module-utils-dynamic <1>
  disabled: false
- package: ./dynamic-plugins/dist/backstage-plugin-catalog-backend-module-gitlab-dynamic <2>
  disabled: false
```
<1> This plugin helps in maniplating file system, and in this case helps in update the the Catalog Envelope file with references to the new component being imported
<2> This plugin helps to discover catalog files located in your GitLab instance. In the next step we will turn ON the auto-discovery feature.


=== Update RHDH config

. Visit your https://gitlab-gitlab.{openshift_cluster_ingress_domain}rhdh/developer-hub-config/[rhdh/developer-hub-config repository on GitLab^].
. Open the *values.yaml* file, then select *Edit > Edit single file*.
. Locate the comment `#PASTE_DYNAMIC_PLUGINS_HERE`
. Move cursor to the beginning of the line (hit backspace repeatedly) and paste the following YAML snippet below the comment

[source,bash,role=execute,subs="attributes"]
----
      - package: ./dynamic-plugins/dist/backstage-plugin-techdocs
        disabled: false
      - package: ./dynamic-plugins/dist/backstage-plugin-techdocs
        disabled: false
----




== Turn auto-discovery