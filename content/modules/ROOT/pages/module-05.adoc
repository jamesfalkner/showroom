:imagesdir: ../assets/images


= Module 5: Build, Test, & Deploy (outer loop)

include::style.adoc[]

== Overview

* PE builds  a production-level pipelines (pre and post merge) based org needs  via Tekton
* Developer creates a new merge-request, the pre-merge pipeline is triggered via Gitlab webhook, and the image is built
* An application owner/team member reviews and accepts the merge-request.
* This kicks off a post-merge pipeline which updates manifests in Dev and Stage env 
* This also issues a merge-request to deploy to Production Environment. 
* Once this prod merge-request is accepted, the application is deployed to production through GitOps/ArgoCD


== As Developer: Merge request from feature-branch to main
* On RHDH, navigate to the Catalog menu, and access the sandbox component you had created. This will be From the feature-branch components's overview page on RHDH, click on *View Source* link to access the git repo of this component.
* You will see an alert asking you to create a *merge request*
+
image:./m5/view-merge-alert.png[]
+
NOTE: If you don't see this alert, you can access this via the *Code -> Merge Requests* left-hand menu, and proceed to click on the *New merge request* button

* In the *New merge request* page, continue to create this merge request by clicking on the *Create merge request* button at the bottom of the page
+
image:./m5/create-merge-alert.png[width=60%]

* parasol-store-build-pr-open pipeline kicks

* View on RHDH under the parasol-store component

* View on OpenShift
https://console-openshift-console.apps.sno.sandbox1887.opentlc.com/pipelines/ns/parasol-build 

Dev merges PR on GitLab

parasol-store-build-pr-merged  pipeline kicks
https://console-openshift-console.apps.sno.sandbox1887.opentlc.com/k8s/ns/parasol-build/tekton.dev~v1~Pipeline/parasol-store-build-pr-merged 


Can view on RHDH as well

Dev and staging manifest gets updated and redeploy automatically to deploy image in dev and staging namespaces
This pipeline ppens a merge request  for production manifests: https://gitlab-gitlab.apps.sno.sandbox1887.opentlc.com/parasol/parasol-store-manifests/-/merge_requests

Merge the PR. This will trigger redeployment in PROD in the GitOps
Navigate to the CD  tab of parasol-store

In a few minutes, it will be deployed successfully



